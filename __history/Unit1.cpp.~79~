//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "Unit1.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm1 *Form1;
//---------------------------------------------------------------------------
__fastcall TForm1::TForm1(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------
void __fastcall TForm1::AfficherClick(TObject *Sender)
{
	this->getListeUtilisateurs();
}
//---------------------------------------------------------------------------
void __fastcall TForm1::Button1Click(TObject *Sender)
{
	this->ajouterUtilisateur(EditLogin->Text,EditPassword->Text,EditPassword2->Text);
}
//---------------------------------------------------------------------------

void __fastcall TForm1::ajouterUtilisateur(AnsiString ELogin, AnsiString EPassword, AnsiString EPassword2)
{
	int verifId=0;
	int verifPass=0;

   // ouverture base et table
   ADOConnection1->Open();
   ADOTable1->Open();

   // on passe en mode insertion
   ADOTable1->Insert();

	verifId = VerifIdentifiant(ELogin);

	verifPass = VerifPassword(EPassword);

	//on vérifie que les 2 mots de passe correspondent
	if (EditPassword->Text==EditPassword2->Text){
		// on insère le login récupéré
		ADOTable1->FieldByName("login")->AsString = ELogin;
		// on insère le mot de passe récupéré
		ADOTable1->FieldByName("password")->AsString = EPassword;

		//on valide les modifications
		ADOTable1->Post();

		EditEtat->Text="Utilisateur ajouté!";
		ColorBoxLogin->Selected=clGreen;
	}
	else{
		EditEtat->Text="Les deux mots de passe ne correspondent pas!";
	}

   // on ferme base et table
   ADOTable1->Close();
   ADOConnection1->Close();
}

//---------------------------------------------------------------------------

int __fastcall TForm1::VerifIdentifiant(AnsiString ELogin)
{
	if(ELogin==""){
		ColorBoxLogin->Selected=clRed;
		return 0;
	}
	else{
		ColorBoxLogin->Selected=clGreen;
		return 1;
	}
}

//---------------------------------------------------------------------------

int __fastcall TForm1::VerifPassword(AnsiString EPassword)
{
	if(EPassword==""){
		ColorBoxPassword1->Selected=clRed;
		return 0;
	}
	else{
		ColorBoxPassword1->Selected=clGreen;
		return 1;
	}
}

//---------------------------------------------------------------------------

void __fastcall TForm1::getListeUtilisateurs()
{
	AnsiString login = "";
	AnsiString password = "";
	Memo_Utilisateurs->Clear();

	// ouverture connexion, bdd et table
	ADOConnection1->Open();
	ADOTable1->Open();

	// on se positionne au début
	ADOTable1->First();

	// tant qu'on est pas à la fin de la table
	while(!ADOTable1->Eof)
	{
		// on récupère les champs login et password
		login = ADOTable1->FieldByName("login")->AsString;
		password = ADOTable1->FieldByName("password")->AsString;

		// on ajoute une ligne à notre mémo
		Memo_Utilisateurs->Lines->Add(login + password);

		// on passe à la ligne suivante
		ADOTable1->Next();
	}

	// on ferme connexion, bdd et table
	ADOTable1->Close();
	ADOConnection1->Close();
}

//---------------------------------------------------------------------------

void __fastcall TForm1::ResetClick(TObject *Sender)
{
	//on efface les valeur des champs Login, Password, Password2 et Etat
	EditLogin->Text="";
	EditPassword->Text="";
	EditPassword2->Text="";
	EditEtat->Text="";
}
//---------------------------------------------------------------------------

